<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 8px 16px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>API Debug Tool</h1>
    
    <div class="test">
        <h3>1. Test Auth Status (GET)</h3>
        <button onclick="testAuthStatusGet()">Test GET /api/auth/status</button>
        <div id="authStatusGetResult"></div>
    </div>
    
    <div class="test">
        <h3>2. Test Auth Status (POST)</h3>
        <button onclick="testAuthStatusPost()">Test POST /api/auth/status</button>
        <div id="authStatusPostResult"></div>
    </div>
    
    <div class="test">
        <h3>3. Test Auth Initiate (POST)</h3>
        <button onclick="testAuthInitiate()">Test POST /api/auth/youtube</button>
        <div id="authInitiateResult"></div>
    </div>
    
    <div class="test">
        <h3>4. Test Local Storage</h3>
        <button onclick="testLocalStorage()">Test Local Storage Functions</button>
        <div id="localStorageResult"></div>
    </div>
    
    <div class="test">
        <h3>5. Current Environment</h3>
        <div id="envInfo"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        
        // Show environment info
        document.getElementById('envInfo').innerHTML = `
            <pre>
Origin: ${window.location.origin}
Host: ${window.location.host}
Protocol: ${window.location.protocol}
API_BASE: ${API_BASE}
User Agent: ${navigator.userAgent}
            </pre>
        `;
        
        async function testAuthStatusGet() {
            const resultDiv = document.getElementById('authStatusGetResult');
            try {
                const response = await fetch('/api/auth/status');
                const data = await response.json();
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <strong>Success!</strong><br>
                    Status: ${response.status}<br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }
        
        async function testAuthStatusPost() {
            const resultDiv = document.getElementById('authStatusPostResult');
            try {
                const response = await fetch('/api/auth/status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        clientId: 'test-client-id',
                        clientSecret: 'test-client-secret',
                        redirectUri: 'https://prafunschool.web.id/api/auth/youtube/callback'
                    })
                });
                const data = await response.json();
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <strong>Success!</strong><br>
                    Status: ${response.status}<br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }

        async function testAuthInitiate() {
            const resultDiv = document.getElementById('authInitiateResult');
            try {
                const response = await fetch('/api/auth/youtube', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        clientId: 'test-client-id',
                        clientSecret: 'test-client-secret',
                        redirectUri: 'https://prafunschool.web.id/api/auth/youtube/callback'
                    })
                });
                const data = await response.json();
                
                resultDiv.className = response.ok ? 'success' : 'error';
                resultDiv.innerHTML = `
                    <strong>${response.ok ? 'Success' : 'Error'}!</strong><br>
                    Status: ${response.status}<br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }

        function testLocalStorage() {
            const resultDiv = document.getElementById('localStorageResult');
            try {
                // Test save credentials
                const testCreds = {
                    clientId: 'test-client-id-123',
                    clientSecret: 'test-client-secret-456',
                    redirectUri: 'https://prafunschool.web.id/api/auth/youtube/callback'
                };
                
                // Save to localStorage
                const encodedCreds = btoa(JSON.stringify(testCreds));
                localStorage.setItem('youtube_credentials', encodedCreds);
                
                // Read back
                const savedCreds = localStorage.getItem('youtube_credentials');
                const decodedCreds = JSON.parse(atob(savedCreds));
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <strong>Local Storage Test Success!</strong><br>
                    Saved: <pre>${JSON.stringify(testCreds, null, 2)}</pre>
                    Retrieved: <pre>${JSON.stringify(decodedCreds, null, 2)}</pre>
                    Match: ${JSON.stringify(testCreds) === JSON.stringify(decodedCreds) ? 'YES' : 'NO'}
                `;
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }
        
        // Auto-run environment test
        window.onload = function() {
            console.log('Debug page loaded');
            console.log('API_BASE:', API_BASE);
        };
    </script>
</body>
</html> 